<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customers Database</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            margin: 20px;
            color: #333;
        }

        .aios-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 30px;
            margin: 20px;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }

        .search-filter-section {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .search-input {
            border: 2px solid #e0e0e0;
            padding: 10px 15px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

            .search-input:focus {
                border-color: #4da3ff;
                box-shadow: 0 0 0 3px rgba(77, 163, 255, 0.1);
            }

        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }

        .aios-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0;
        }

            .aios-table th,
            .aios-table td {
                padding: 16px;
                text-align: left;
                border-bottom: 1px solid #e9ecef;
                vertical-align: middle;
            }

            .aios-table th {
                background-color: #f8f9fa;
                font-weight: 600;
                color: #495057;
                text-transform: uppercase;
                font-size: 13px;
                letter-spacing: 0.5px;
            }

        .customer-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .vehicle-badge {
            display: inline-block;
            padding: 6px 12px;
            background-color: #e3f2fd;
            color: #1976d2;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .btn-aios {
            background-color: #4da3ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

            .btn-aios:hover {
                background-color: #3a8ee6;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(77, 163, 255, 0.3);
            }

        #noResults {
            padding: 60px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>

<body>
    <h2 class="page-title">Customers</h2>

    <div class="aios-card fade-in">

        <!-- Search + Filter section -->
        <div class="search-filter-section mb-4">
            <div class="row align-items-end">

                <!-- Search -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Search</label>
                    <input type="text" class="form-control search-input" id="searchInput" placeholder="Search customers...">
                </div>

                <!-- Filter -->
                <div class="col-md-3">
                    <label class="form-label fw-bold">Filter By</label>
                    <select class="form-select" id="filterType">
                        <option value="all">All Fields</option>
                        <option value="name">Customer Name</option>
                        <option value="email">Email</option>
                        <option value="phone">Phone</option>
                        <option value="vehicle">Vehicle</option>
                        <option value="vin">VIN</option>
                    </select>

                    <!-- Apply Filters Button -->
                    <button type="button" class="btn-aios mt-2 w-100" onclick="performSearch()">
                        <i class="bi bi-funnel"></i> Apply Filters
                    </button>
                </div>

                <!-- Add Customer -->
                <div class="col-md-3 text-end">
                    <button type="button" class="btn-aios w-100" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                        <i class="bi bi-plus-circle"></i> Add Customer
                    </button>
                </div>

            </div>
        </div>

        <!-- Summary -->
        <div class="mb-3">
            <span class="text-muted" id="resultsCount">Loading...</span>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading customers...</p>
        </div>

        <!-- Table -->
        <div class="table-responsive" id="customersTable" style="display:none;">
            <table class="aios-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Vehicle</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="customersTableBody">
                    <!-- Customers will be loaded here dynamically -->
                </tbody>
            </table>
        </div>

        <div id="noResults" class="text-center py-5" style="display:none;">
            <i class="bi bi-search" style="font-size:3rem;color:#ccc;"></i>
            <p class="text-muted mt-3">No customers found matching your search.</p>
        </div>

    </div>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCustomerModalLabel">
                        <i class="bi bi-person-plus"></i> Add New Customer
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCustomerForm">
                        <div class="mb-3">
                            <label for="customerName" class="form-label">Customer Name *</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="customerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerPhone" class="form-label">Phone *</label>
                            <input type="tel" class="form-control" id="customerPhone" placeholder="403-555-1234" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerVehicle" class="form-label">Vehicle *</label>
                            <input type="text" class="form-control" id="customerVehicle" placeholder="2021 Audi A4" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerVIN" class="form-label">VIN *</label>
                            <input type="text" class="form-control" id="customerVIN" placeholder="WAUENAF41LA123456" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">
                        <i class="bi bi-save"></i> Save Customer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // API Base URL - Update this to match your server port
        const API_URL = 'https://localhost:7123/api/customers'; // Change port if needed

        let allCustomers = [];

        // Load customers from MongoDB on page load
        async function loadCustomers() {
            try {
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                allCustomers = await response.json();
                displayCustomers(allCustomers);

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('customersTable').style.display = 'block';

            } catch (error) {
                console.error('Error loading customers:', error);
                document.getElementById('loadingState').innerHTML = `
                    <i class="bi bi-exclamation-triangle text-danger" style="font-size:3rem;"></i>
                    <p class="text-danger mt-3">Failed to load customers. Please check your connection.</p>
                    <p class="text-muted">Error: ${error.message}</p>
                `;
            }
        }

        // Display customers in the table
        function displayCustomers(customers) {
            const tbody = document.getElementById('customersTableBody');
            tbody.innerHTML = '';

            if (customers.length === 0) {
                document.getElementById('customersTable').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
                document.getElementById('resultsCount').innerHTML = 'Showing <strong>0</strong> customer(s)';
                return;
            }

            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.setAttribute('data-name', customer.name);
                row.setAttribute('data-email', customer.email);
                row.setAttribute('data-phone', customer.phone);
                row.setAttribute('data-vehicle', customer.vehicle);
                row.setAttribute('data-vin', customer.vin);

                row.innerHTML = `
                    <td><div class="customer-name">${customer.name}</div></td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td><span class="vehicle-badge">${customer.vehicle}</span></td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewCustomer('${customer.id}')">
                            <i class="bi bi-eye"></i> View
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer('${customer.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('resultsCount').innerHTML =
                `Showing <strong>${customers.length}</strong> customer(s)`;
            document.getElementById('customersTable').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
        }

        // Save new customer to MongoDB
        async function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const vehicle = document.getElementById('customerVehicle').value.trim();
            const vin = document.getElementById('customerVIN').value.trim();

            if (!name || !email || !phone || !vehicle || !vin) {
                alert('Please fill in all fields');
                return;
            }

            const customer = {
                name: name,
                email: email,
                phone: phone,
                vehicle: vehicle,
                vin: vin
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(customer)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
                modal.hide();

                // Clear form
                document.getElementById('addCustomerForm').reset();

                // Reload customers
                await loadCustomers();

                alert('Customer added successfully!');

            } catch (error) {
                console.error('Error saving customer:', error);
                alert('Failed to save customer. Please try again.');
            }
        }

        // Delete customer
        async function deleteCustomer(id) {
            if (!confirm('Are you sure you want to delete this customer?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                await loadCustomers();
                alert('Customer deleted successfully!');

            } catch (error) {
                console.error('Error deleting customer:', error);
                alert('Failed to delete customer. Please try again.');
            }
        }

        // View customer details
        function viewCustomer(id) {
            const customer = allCustomers.find(c => c.id === id);
            if (customer) {
                alert(`Customer Details:\n\nName: ${customer.name}\nEmail: ${customer.email}\nPhone: ${customer.phone}\nVehicle: ${customer.vehicle}\nVIN: ${customer.vin}`);
            }
        }

        // Search and filter
        function performSearch() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
            const filterType = document.getElementById('filterType').value;

            if (searchValue === '') {
                displayCustomers(allCustomers);
                return;
            }

            const filtered = allCustomers.filter(customer => {
                let value = '';

                switch (filterType) {
                    case 'name': value = customer.name.toLowerCase(); break;
                    case 'email': value = customer.email.toLowerCase(); break;
                    case 'phone': value = customer.phone.toLowerCase(); break;
                    case 'vehicle': value = customer.vehicle.toLowerCase(); break;
                    case 'vin': value = customer.vin.toLowerCase(); break;
                    default:
                        value = `${customer.name} ${customer.email} ${customer.phone} ${customer.vehicle} ${customer.vin}`.toLowerCase();
                }

                return value.includes(searchValue);
            });

            displayCustomers(filtered);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadCustomers();

            // Add enter key support for search
            document.getElementById('searchInput').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        });
    </script>

</body>
</html>